export type Language = "zh" | "en";

export const LANGUAGE_CHANGE_EVENT = "aipl-language-changed";
const STORAGE_KEY = "aipl.language";

export const TRANSLATIONS = {
  zh: {
    status: {
      todo: "待执行",
      doing: "执行中",
      done: "完成",
      failed: "失败",
      canceled: "已取消",
      stale: "过期",
      running: "运行中",
      awaiting_review: "待审核",
      discarded: "已丢弃",
      connected: "已连接",
      connecting: "连接中",
      disconnected: "已断开",
      queued: "排队中",
      starting: "启动中",
      retrying: "重试中",
      completed: "已完成",
      pending: "待审核",
      approved: "已通过",
      applied: "已应用",
      rejected: "已拒绝",
      reworking: "返工中"
    },
    buttons: {
      back: "返回",
      refresh: "刷新",
      delete: "删除",
      cancel: "取消",
      terminateChat: "终止聊天",
      terminatePlan: "终止任务生成",
      retry: "重试",
      apply: "应用",
      discard: "丢弃",
      rework: "返工",
      save: "保存",
      confirm: "确认",
      send: "发送",
      prevPage: "上一页",
      nextPage: "下一页",
      startFlow: "开始流程",
      newChat: "新建对话",
      rename: "重命名",
      addQueue: "加入队列",
      replan: "重新规划",
      retryWithDeps: "重试并包含依赖",
      retryForce: "强制重试",
      deleteRun: "删除执行",
      deletePlan: "删除计划",
      cancelRun: "取消执行",
      applyReview: "通过审核并应用",
      discardChanges: "丢弃",
      reworkStep: "返工当前步骤",
      load: "加载",
      propose: "提议",
      approve: "通过",
      reject: "拒绝",
      pauseQueue: "暂停队列",
      resumeQueue: "继续队列",
      terminateQueue: "终止队列",
      clearQueue: "清空队列",
      viewList: "列表",
      viewGraph: "图形"
    },
    titles: {
      dashboard: "仪表盘",
      plans: "计划",
      runs: "执行",
      pilot: "导航",
      profile: "配置",
      runInfo: "执行信息",
      planInfo: "计划信息",
      taskChain: "任务链",
      events: "事件",
      review: "审核",
      queue: "队列",
      planPreview: "计划预览",
      taskChainProgress: "任务链进度",
      reviewApply: "审核与应用",
      rework: "返工",
      planText: "计划文本",
      hardPolicy: "硬策略",
      softDraft: "软策略草案",
      softApproved: "软策略已通过",
      chat: "对话"
    },
    messages: {
      noPlans: "暂无计划",
      noRuns: "暂无执行",
      noEvents: "等待事件...",
      loading: "加载中...",
      confirmDelete: "确定删除吗？",
      confirmCancel: "确定取消吗？",
      confirmApply: "确认通过审核并应用吗？",
      loadFailed: "加载失败",
      noMatchingPlans: "没有匹配的计划",
      noMatchingRuns: "没有匹配的执行",
      needCreateChat: "请先创建对话。",
      needDescribeTask: "请先在对话中描述任务。",
      startRunFailedNoId: "启动执行失败：未返回 run_id",
      planGenerated: "计划已生成",
      planGeneratedNoId: "计划已生成。",
      planEmpty: "暂无计划文本。",
      taskChainEmpty: "任务链：(空)",
      chatFailed: "对话失败",
      planFailed: "生成计划失败",
      loadRunFailed: "加载执行失败",
      loadPlanFailed: "加载计划失败",
      planLocked: "任务链执行中或待审核，暂不能创建新任务链",
      loadPatchsetFailed: "加载补丁集失败",
      loadFailureDetailFailed: "加载失败详情失败",
      applyFailed: "应用失败",
      deleteFailed: "删除失败",
      cancelFailed: "取消失败",
      retryFailed: "重试失败",
      reworkFailed: "返工失败",
      discardFailed: "丢弃失败",
      openFileFailed: "打开文件失败",
      confirmDeleteRun: "确认删除这个 run 吗？相关 artifacts 也会被删除。",
      confirmDeletePlan: "确认删除这个 plan 吗？相关 runs 和 artifacts 也会被删除。",
      confirmCancelRun: "确认取消当前执行吗？",
      confirmDeleteChat: "确定删除这个对话吗？",
      confirmApproveProfile: "确认通过这个配置吗？",
      confirmRejectProfile: "确认拒绝这个配置吗？",
      runCompletedApplyHint: "执行完成。如需修改请审核并应用。",
      taskChainLoading: "加载任务链中...",
      taskChainEmptyData: "暂无任务链数据。",
      reviewLoading: "加载补丁集中...",
      eventStreamReconnecting: "正在重连...",
      eventStreamWaiting: "等待事件中...",
      eventStreamDisconnected: "事件流已断开。",
      awaitingReviewReady: "等待审核（补丁集已就绪）",
      runFailed: "执行失败",
      runCanceled: "已取消",
      runDiscarded: "已丢弃",
      runCompleted: "已完成",
      codexTimeout: "Codex 超时",
      codexFailed: "Codex 失败",
      codexStart: "Codex 生成中",
      codexDone: "Codex 已响应",
      subagentStart: "子代理运行中",
      subagentDone: "验证器运行中",
      verificationDone: "验证完成",
      stageReady: "Stage 工作区就绪",
      runInit: "执行初始化",
      patchsetReady: "补丁集就绪",
      awaitingReview: "等待审核",
      applyStart: "正在应用变更",
      applyDone: "变更已应用",
      discardDone: "变更已丢弃",
      runDone: "执行完成",
      stepRound: "步骤轮次",
      stepRoundRunning: "步骤轮次进行中",
      running: "运行中",
      reworkFeedbackPlaceholder: "可选：返工反馈",
      reworkNeedStep: "获取到步骤 ID 后才能返工。",
      reworkPrepared: "已为 {stepId} 准备返工，请在返工面板提交。",
      finalPlanPrompt: "请确认最终计划内容（可编辑）：",
      taskInputPlaceholder: "描述你要执行的任务",
      chatLoading: "对话中",
      planLoading: "Codex 生成计划中...",
      sendLoading: "发送中...",
      queueEmpty: "暂无队列任务。",
      noVerificationFailures: "无验证失败信息。",
      noProfile: "暂无配置。"
    },
    labels: {
      workspacePath: "工作区路径",
      searchPlans: "搜索计划",
      searchRuns: "搜索执行",
      updated: "更新",
      tasks: "任务",
      status: "状态",
      run: "执行",
      plan: "计划",
      workspace: "工作区",
      policy: "策略",
      runId: "执行 ID",
      planId: "计划 ID",
      inputTask: "输入任务",
      currentStage: "当前阶段",
      task: "任务",
      taskChain: "任务链",
      taskChainProgress: "任务链进度",
      taskId: "ID",
      dependencies: "依赖",
      capabilities: "能力",
      stream: "流",
      queueActions: "队列操作",
      queueStatusGlobal: "队列状态（全局）",
      chatTitle: "对话名称",
      finalPlan: "最终计划",
      listView: "列表",
      graphView: "图形",
      policySafe: "安全",
      policyGuarded: "守护",
      policyFull: "完全",
      tasksDone: "完成",
      tasksDoing: "执行中",
      tasksFailed: "失败",
      roleSystem: "系统",
      roleUser: "用户",
      roleAssistant: "助手",
      warning: "警告",
      error: "错误",
      command: "命令",
      file: "文件",
      expected: "期望",
      actual: "实际",
      hint: "提示"
    },
    prompts: {
      systemLanguage: "请使用中文回复。",
      finalPlanPrefix: "最终计划："
    }
  },
  en: {
    status: {
      todo: "Todo",
      doing: "In progress",
      done: "Done",
      failed: "Failed",
      canceled: "Canceled",
      stale: "Stale",
      running: "Running",
      awaiting_review: "Awaiting review",
      discarded: "Discarded",
      connected: "Connected",
      connecting: "Connecting",
      disconnected: "Disconnected",
      queued: "Queued",
      starting: "Starting",
      retrying: "Retrying",
      completed: "Completed",
      pending: "Pending review",
      approved: "Approved",
      applied: "Applied",
      rejected: "Rejected",
      reworking: "Reworking"
    },
    buttons: {
      back: "Back",
      refresh: "Refresh",
      delete: "Delete",
      cancel: "Cancel",
      terminateChat: "Stop chat",
      terminatePlan: "Stop task generation",
      retry: "Retry",
      apply: "Apply",
      discard: "Discard",
      rework: "Rework",
      save: "Save",
      confirm: "Confirm",
      send: "Send",
      prevPage: "Prev",
      nextPage: "Next",
      startFlow: "Start flow",
      newChat: "New chat",
      rename: "Rename",
      addQueue: "Add to queue",
      replan: "Replan",
      retryWithDeps: "Retry with dependencies",
      retryForce: "Force retry",
      deleteRun: "Delete run",
      deletePlan: "Delete plan",
      cancelRun: "Cancel run",
      applyReview: "Apply after review",
      discardChanges: "Discard",
      reworkStep: "Rework current step",
      load: "Load",
      propose: "Propose",
      approve: "Approve",
      reject: "Reject",
      pauseQueue: "Pause queue",
      resumeQueue: "Resume queue",
      terminateQueue: "Terminate queue",
      clearQueue: "Clear queue",
      viewList: "List",
      viewGraph: "Graph"
    },
    titles: {
      dashboard: "Dashboard",
      plans: "Plans",
      runs: "Runs",
      pilot: "Pilot",
      profile: "Profile",
      runInfo: "Run info",
      planInfo: "Plan info",
      taskChain: "Task chain",
      events: "Events",
      review: "Review",
      queue: "Queue",
      planPreview: "Plan preview",
      taskChainProgress: "Task chain progress",
      reviewApply: "Review and apply",
      rework: "Rework",
      planText: "Plan text",
      hardPolicy: "Hard policy",
      softDraft: "Soft draft",
      softApproved: "Soft approved",
      chat: "Chat"
    },
    messages: {
      noPlans: "No plans",
      noRuns: "No runs",
      noEvents: "Waiting for events...",
      loading: "Loading...",
      confirmDelete: "Confirm delete?",
      confirmCancel: "Confirm cancel?",
      confirmApply: "Confirm apply after review?",
      loadFailed: "Load failed",
      noMatchingPlans: "No matching plans",
      noMatchingRuns: "No matching runs",
      needCreateChat: "Create a chat first.",
      needDescribeTask: "Describe the task in the chat first.",
      startRunFailedNoId: "Failed to start run: missing run_id",
      planGenerated: "Plan created",
      planGeneratedNoId: "Plan created.",
      planEmpty: "No plan text.",
      taskChainEmpty: "Task chain: (empty)",
      chatFailed: "Chat failed",
      planFailed: "Plan generation failed",
      loadRunFailed: "Failed to load run",
      loadPlanFailed: "Failed to load plan",
      planLocked: "Plan is executing or awaiting review; cannot create a new plan.",
      loadPatchsetFailed: "Failed to load patchset",
      loadFailureDetailFailed: "Failed to load failure details",
      applyFailed: "Apply failed",
      deleteFailed: "Delete failed",
      cancelFailed: "Cancel failed",
      retryFailed: "Retry failed",
      reworkFailed: "Rework failed",
      discardFailed: "Discard failed",
      openFileFailed: "Failed to open file",
      confirmDeleteRun: "Delete this run? Related artifacts will also be removed.",
      confirmDeletePlan: "Delete this plan? Related runs and artifacts will also be removed.",
      confirmCancelRun: "Cancel the current run?",
      confirmDeleteChat: "Delete this chat?",
      confirmApproveProfile: "Approve this profile?",
      confirmRejectProfile: "Reject this profile?",
      runCompletedApplyHint: "Run completed. Review and apply changes if needed.",
      taskChainLoading: "Loading task chain...",
      taskChainEmptyData: "No task chain data.",
      reviewLoading: "Loading patchset...",
      eventStreamReconnecting: "Reconnecting...",
      eventStreamWaiting: "Waiting for events...",
      eventStreamDisconnected: "Event stream disconnected.",
      awaitingReviewReady: "Awaiting review (patchset ready)",
      runFailed: "Run failed",
      runCanceled: "Canceled",
      runDiscarded: "Discarded",
      runCompleted: "Completed",
      codexTimeout: "Codex timeout",
      codexFailed: "Codex failed",
      codexStart: "Codex generating",
      codexDone: "Codex responded",
      subagentStart: "Sub-agent running",
      subagentDone: "Verifier running",
      verificationDone: "Verification completed",
      stageReady: "Stage workspace ready",
      runInit: "Run initialized",
      patchsetReady: "Patchset ready",
      awaitingReview: "Awaiting review",
      applyStart: "Applying changes",
      applyDone: "Changes applied",
      discardDone: "Changes discarded",
      runDone: "Run completed",
      stepRound: "Step round",
      stepRoundRunning: "Step round in progress",
      running: "Running",
      reworkFeedbackPlaceholder: "Optional: rework feedback",
      reworkNeedStep: "Step ID is required before rework.",
      reworkPrepared: "Rework prepared for {stepId}. Submit in the rework panel.",
      finalPlanPrompt: "Confirm the final plan (editable):",
      taskInputPlaceholder: "Describe the task you want to run",
      chatLoading: "Chatting",
      planLoading: "Codex is generating a plan...",
      sendLoading: "Sending...",
      queueEmpty: "No queued items.",
      noVerificationFailures: "No verification failures.",
      noProfile: "No profile data."
    },
    labels: {
      workspacePath: "Workspace path",
      searchPlans: "Search plans",
      searchRuns: "Search runs",
      updated: "Updated",
      tasks: "Tasks",
      status: "Status",
      run: "Run",
      plan: "Plan",
      workspace: "Workspace",
      policy: "Policy",
      runId: "Run ID",
      planId: "Plan ID",
      inputTask: "Input task",
      currentStage: "Current stage",
      task: "Task",
      taskChain: "Task chain",
      taskChainProgress: "Task chain progress",
      taskId: "ID",
      dependencies: "Dependencies",
      capabilities: "Capabilities",
      stream: "Stream",
      queueActions: "Queue actions",
      queueStatusGlobal: "Queue status (global)",
      chatTitle: "Chat title",
      finalPlan: "Final plan",
      listView: "List",
      graphView: "Graph",
      policySafe: "Safe",
      policyGuarded: "Guarded",
      policyFull: "Full",
      tasksDone: "Done",
      tasksDoing: "In progress",
      tasksFailed: "Failed",
      roleSystem: "System",
      roleUser: "User",
      roleAssistant: "Assistant",
      warning: "Warning",
      error: "Error",
      command: "Command",
      file: "File",
      expected: "Expected",
      actual: "Actual",
      hint: "Hint"
    },
    prompts: {
      systemLanguage: "Please respond in English.",
      finalPlanPrefix: "Final plan:"
    }
  }
};

export type TranslationKeys = typeof TRANSLATIONS["zh"];

export function getLabels(language: Language): TranslationKeys {
  return TRANSLATIONS[language];
}

export function getStoredLanguage(): Language {
  if (typeof window === "undefined") return "zh";
  const stored = localStorage.getItem(STORAGE_KEY);
  return stored === "en" || stored === "zh" ? stored : "zh";
}

export function setStoredLanguage(language: Language): void {
  if (typeof window === "undefined") return;
  localStorage.setItem(STORAGE_KEY, language);
  window.dispatchEvent(new CustomEvent<Language>(LANGUAGE_CHANGE_EVENT, { detail: language }));
}

export const LABELS = TRANSLATIONS.zh;
