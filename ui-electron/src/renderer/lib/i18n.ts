export type Language = "zh" | "en";

export const LANGUAGE_CHANGE_EVENT = "aipl-language-changed";
const STORAGE_KEY = "aipl.language";

export const TRANSLATIONS = {
  zh: {
    status: {
      todo: "待执行",
      doing: "执行中",
      done: "完成",
      failed: "失败",
      canceled: "已取消",
      stale: "过期",
      running: "运行中",
      awaiting_review: "待审核",
      discarded: "已丢弃",
      connected: "已连接",
      connecting: "连接中",
      disconnected: "已断开",
      queued: "排队中",
      starting: "启动中",
      retrying: "重试中",
      completed: "已完成",
      pending: "待审核",
      approved: "已通过",
      applied: "已应用",
      rejected: "已拒绝",
      reworking: "返工中"
    },
    buttons: {
      back: "返回",
      refresh: "刷新",
      resetDefaults: "重置默认",
      delete: "删除",
      cancel: "取消",
      terminateChat: "终止聊天",
      terminatePlan: "终止任务生成",
      retry: "重试",
      apply: "应用",
      discard: "丢弃",
      rework: "返工",
      save: "保存",
      confirm: "确认",
      send: "发送",
      prevPage: "上一页",
      nextPage: "下一页",
      startFlow: "开始流程",
      newChat: "新建对话",
      rename: "重命名",
      addQueue: "加入队列",
      addCheck: "添加检查项",
      addRule: "添加规则",
      replan: "重新规划",
      retryWithDeps: "重试并包含依赖",
      retryForce: "强制重试",
      deleteRun: "删除执行",
      deletePlan: "删除计划",
      cancelRun: "取消执行",
      applyReview: "通过审核并应用",
      discardChanges: "丢弃",
      reworkStep: "返工当前步骤",
      load: "加载",
      propose: "提议",
      approve: "通过",
      reject: "拒绝",
      pauseQueue: "暂停队列",
      resumeQueue: "继续队列",
      terminateQueue: "终止队列",
      clearQueue: "清空队列",
      viewList: "列表",
      viewGraph: "图形",
      importJson: "导入 JSON",
      export: "导出",
      exportFile: "导出文件",
      chooseFile: "选择文件",
      disable: "禁用",
      enable: "启用",
      close: "关闭",
      copy: "复制"
    },
    titles: {
      dashboard: "仪表盘",
      plans: "计划",
      runs: "执行",
      pilot: "导航",
      profile: "配置",
      runInfo: "执行信息",
      planInfo: "计划信息",
      taskChain: "任务链",
      events: "事件",
      review: "审核",
      queue: "队列",
      planPreview: "计划预览",
      packages: "包管理",
      languagePacks: "语言包",
      experiencePacks: "经验包",
      memory: "经验库",
      taskChainProgress: "任务链进度",
      reviewApply: "审核与应用",
      rework: "返工",
      planText: "计划文本",
      hardPolicy: "硬策略",
      softDraft: "软策略草案",
      softApproved: "软策略已通过",
      chat: "对话"
    },
    messages: {
      noPlans: "暂无计划",
      noRuns: "暂无执行",
      noEvents: "等待事件...",
      loading: "加载中...",
      confirmDelete: "确定删除吗？",
      confirmCancel: "确定取消吗？",
      confirmApply: "确认通过审核并应用吗？",
      loadFailed: "加载失败",
      noMatchingPlans: "没有匹配的计划",
      noMatchingRuns: "没有匹配的执行",
      needCreateChat: "请先创建对话。",
      needDescribeTask: "请先在对话中描述任务。",
      startRunFailedNoId: "启动执行失败：未返回 run_id",
      planGenerated: "计划已生成",
      planGeneratedNoId: "计划已生成。",
      planEmpty: "暂无计划文本。",
      taskChainEmpty: "任务链：(空)",
      chatFailed: "对话失败",
      planFailed: "生成计划失败",
      loadRunFailed: "加载执行失败",
      loadPlanFailed: "加载计划失败",
      planLocked: "任务链执行中或待审核，暂不能创建新任务链",
      loadPatchsetFailed: "加载补丁集失败",
      loadFailureDetailFailed: "加载失败详情失败",
      applyFailed: "应用失败",
      deleteFailed: "删除失败",
      cancelFailed: "取消失败",
      retryFailed: "重试失败",
      reworkFailed: "返工失败",
      discardFailed: "丢弃失败",
      openFileFailed: "打开文件失败",
      confirmDeleteRun: "确认删除这个 run 吗？相关 artifacts 也会被删除。",
      confirmDeletePlan: "确认删除这个 plan 吗？相关 runs 和 artifacts 也会被删除。",
      confirmCancelRun: "确认取消当前执行吗？",
      confirmDeleteChat: "确定删除这个对话吗？",
      confirmApproveProfile: "确认通过这个配置吗？",
      confirmRejectProfile: "确认拒绝这个配置吗？",
      runCompletedApplyHint: "执行完成。如需修改请审核并应用。",
      taskChainLoading: "加载任务链中...",
      taskChainEmptyData: "暂无任务链数据。",
      reviewLoading: "加载补丁集中...",
      eventStreamReconnecting: "正在重连...",
      eventStreamWaiting: "等待事件中...",
      eventStreamDisconnected: "事件流已断开。",
      awaitingReviewReady: "等待审核（补丁集已就绪）",
      runFailed: "执行失败",
      runCanceled: "已取消",
      runDiscarded: "已丢弃",
      runCompleted: "已完成",
      codexTimeout: "Codex 超时",
      codexFailed: "Codex 失败",
      codexStart: "Codex 生成中",
      codexDone: "Codex 已响应",
      subagentStart: "子代理运行中",
      subagentDone: "验证器运行中",
      verificationDone: "验证完成",
      stageReady: "Stage 工作区就绪",
      runInit: "执行初始化",
      patchsetReady: "补丁集就绪",
      awaitingReview: "等待审核",
      applyStart: "正在应用变更",
      applyDone: "变更已应用",
      discardDone: "变更已丢弃",
      runDone: "执行完成",
      stepRound: "步骤轮次",
      stepRoundRunning: "步骤轮次进行中",
      running: "运行中",
      reworkFeedbackPlaceholder: "可选：返工反馈",
      reworkNeedStep: "获取到步骤 ID 后才能返工。",
      reworkPrepared: "已为 {stepId} 准备返工，请在返工面板提交。",
      finalPlanPrompt: "请确认最终计划内容（可编辑）：",
      taskInputPlaceholder: "描述你要执行的任务",
      chatLoading: "对话中",
      planLoading: "Codex 生成计划中...",
      sendLoading: "发送中...",
      queueEmpty: "暂无队列任务。",
      noVerificationFailures: "无验证失败信息。",
      noProfile: "暂无配置。",
      policyNotice: "文件访问与命令执行权限将限制 AI 助手的行为，请谨慎配置。",
      checksGuide: "在执行前添加更多验证，确保操作安全。",
      rulesGuide: "定义团队经验与实践准则，指导 AI 的行为。",
      packageIntro: "从这里可以打开语言包或经验包界面，支持格式检测、导入导出与 Markdown 预览。",
      noBuiltinPacks: "没有内置包",
      noUserPacks: "没有用户包",
      noLearnedPack: "没有学习包",
      workspaceIdNotFound: "没有找到工作区 ID",
      packFormatInvalid: "包格式不符合规范",
      packParseFailed: "包文件解析失败",
      noLessons: "没有教学记录",
      noCommandPatterns: "暂无命令模板",
      noErrorSignatures: "暂无错误签名",
      noFixHints: "暂无修复提示",
      noChecks: "暂无检查项",
      noRules: "暂无规则",
      noImportedPacks: "没有导入包"
    },
    labels: {
      workspacePath: "工作区路径",
      searchPlans: "搜索计划",
      searchRuns: "搜索执行",
      updated: "更新",
      tasks: "任务",
      status: "状态",
      run: "执行",
      plan: "计划",
      workspace: "工作区",
      workspacePathDescription: "当前加载的项目工作区路径",
      workspacePlaceholder: "输入工作区路径",
      browse: "浏览",
      policy: "策略",
      policyConfig: "策略配置",
      policyConfigDescription: "管理 AI 助手的策略、检查项与行为规则",
      extraChecks: "检查项",
      checksDescription: "在执行前添加更多验证",
      rules: "规则",
      rulesDescription: "定义团队经验与实践准则",
      checksPanelMeta: "列出有效的检查项，保障任务前置条件。",
      addCheck: "添加检查项",
      checksFormMeta: "以 JSON 描述验证逻辑，按 Enter 添加。",
      checkJsonPlaceholder: "使用 JSON 描述检查",
      scopeOptional: "作用范围（选填）",
      rulesPanelMeta: "记录团队共享的行为准则。",
      addRule: "添加规则",
      rulesFormMeta: "描述行为准则（可选分类、范围）。",
      ruleContent: "规则内容",
      categoryOptional: "分类（选填）",
      runId: "执行 ID",
      planId: "计划 ID",
      inputTask: "输入任务",
      currentStage: "当前阶段",
      task: "任务",
      taskChain: "任务链",
      taskChainProgress: "任务链进度",
      taskId: "ID",
      dependencies: "依赖",
      capabilities: "能力",
      stream: "流",
      queueActions: "队列操作",
      queueStatusGlobal: "队列状态（全局）",
      chatTitle: "对话名称",
      finalPlan: "最终计划",
      listView: "列表",
      graphView: "图形",
      profileSubtitle: "管理 AI 助手的策略、检查项与行为规则",
      policySafe: "安全",
      policyGuarded: "守护",
      policyFull: "完全",
      tasksDone: "完成",
      tasksDoing: "执行中",
      tasksFailed: "失败",
      fileAccessPolicy: "文件访问权限",
      fileAccessPolicyDescription: "控制 AI 可读取或写入的文件与目录",
      hardPolicyAllowWrite: "允许写入",
      allowWriteHelp: "指定允许 AI 写入的路径或文件",
      allowWritePlaceholder: "添加允许写入的路径",
      hardPolicyDenyWrite: "禁止写入",
      denyWriteHelp: "防止 AI 修改敏感目录",
      denyWritePlaceholder: "添加禁止写入的路径",
      commandPolicy: "命令执行权限",
      commandPolicyDescription: "控制 AI 可以执行的命令和工具",
      hardPolicyAllowedCommands: "允许的命令",
      allowedCommandsHelp: "输入 AI 可以调用的命令或工具名称",
      allowedCommandsPlaceholder: "添加更多命令...",
      executionPolicy: "执行参数",
      executionPolicyDescription: "设置命令执行的超时时间与并发限制",
      hardPolicyCommandTimeout: "命令超时",
      commandTimeoutHelp: "超过此时间后命令将被终止",
      secondsUnit: "秒",
      hardPolicyMaxConcurrency: "并发数量",
      maxConcurrencyHelp: "限制同时执行的命令数量",
      hardPolicyReasons: "拒绝原因",
      packageSubtitle: "管理语言包与经验包的导入导出",
      packageIntroTitle: "包管理",
      languagePack: "语言包",
      experiencePack: "经验包",
      active: "活跃",
      builtin: "内置",
      user: "用户",
      learned: "学习",
      importPack: "导入包",
      selectedFile: "已选文件",
      dragPackHere: "将包文件拖到此处",
      dropFileHint: "仅支持 JSON 格式",
      stats: "统计",
      lessons: "教学记录",
      importedPacks: "已导入包",
      exportMemory: "导出经验",
      exportName: "导出名称",
      description: "描述",
      info: "信息",
      name: "名称",
      version: "版本",
      source: "来源",
      author: "作者",
      tags: "标签",
      applicability: "适用范围",
      projectTypes: "项目类型",
      detectPatterns: "检测模式",
      commandPatterns: "命令模板",
      errorSignatures: "错误签名",
      fixHints: "修复提示",
      enabled: "已启用",
      yes: "是",
      no: "否",
      successRate: "成功率",
      activeRuns: "活跃运行",
      systemResources: "系统资源",
      roleSystem: "系统",
      roleUser: "用户",
      roleAssistant: "助手",
      warning: "警告",
      error: "错误",
      command: "命令",
      file: "文件",
      expected: "期望",
      actual: "实际",
      hint: "提示",
      tagInputHint: "按 Enter 添加"
    },
    prompts: {
      systemLanguage: "请使用中文回复。",
      finalPlanPrefix: "最终计划："
    }
  },
  en: {
    status: {
      todo: "Todo",
      doing: "In progress",
      done: "Done",
      failed: "Failed",
      canceled: "Canceled",
      stale: "Stale",
      running: "Running",
      awaiting_review: "Awaiting review",
      discarded: "Discarded",
      connected: "Connected",
      connecting: "Connecting",
      disconnected: "Disconnected",
      queued: "Queued",
      starting: "Starting",
      retrying: "Retrying",
      completed: "Completed",
      pending: "Pending review",
      approved: "Approved",
      applied: "Applied",
      rejected: "Rejected",
      reworking: "Reworking"
    },
    buttons: {
      back: "Back",
      refresh: "Refresh",
      resetDefaults: "Reset defaults",
      delete: "Delete",
      cancel: "Cancel",
      terminateChat: "Stop chat",
      terminatePlan: "Stop task generation",
      retry: "Retry",
      apply: "Apply",
      discard: "Discard",
      rework: "Rework",
      save: "Save",
      confirm: "Confirm",
      send: "Send",
      prevPage: "Prev",
      nextPage: "Next",
      startFlow: "Start flow",
      newChat: "New chat",
      rename: "Rename",
      addQueue: "Add to queue",
      addCheck: "Add check",
      addRule: "Add rule",
      replan: "Replan",
      retryWithDeps: "Retry with dependencies",
      retryForce: "Force retry",
      deleteRun: "Delete run",
      deletePlan: "Delete plan",
      cancelRun: "Cancel run",
      applyReview: "Apply after review",
      discardChanges: "Discard",
      reworkStep: "Rework current step",
      load: "Load",
      propose: "Propose",
      approve: "Approve",
      reject: "Reject",
      pauseQueue: "Pause queue",
      resumeQueue: "Resume queue",
      terminateQueue: "Terminate queue",
      clearQueue: "Clear queue",
      viewList: "List",
      viewGraph: "Graph",
      importJson: "Import JSON",
      export: "Export",
      exportFile: "Export file",
      chooseFile: "Choose file",
      disable: "Disable",
      enable: "Enable",
      close: "Close",
      copy: "Copy"
    },
    titles: {
      dashboard: "Dashboard",
      plans: "Plans",
      runs: "Runs",
      pilot: "Pilot",
      profile: "Profile",
      runInfo: "Run info",
      planInfo: "Plan info",
      taskChain: "Task chain",
      events: "Events",
      review: "Review",
      queue: "Queue",
      planPreview: "Plan preview",
      packages: "Packages",
      languagePacks: "Language packs",
      experiencePacks: "Experience packs",
      memory: "Memory",
      taskChainProgress: "Task chain progress",
      reviewApply: "Review and apply",
      rework: "Rework",
      planText: "Plan text",
      hardPolicy: "Hard policy",
      softDraft: "Soft draft",
      softApproved: "Soft approved",
      chat: "Chat"
    },
    messages: {
      noPlans: "No plans",
      noRuns: "No runs",
      noEvents: "Waiting for events...",
      loading: "Loading...",
      confirmDelete: "Confirm delete?",
      confirmCancel: "Confirm cancel?",
      confirmApply: "Confirm apply after review?",
      loadFailed: "Load failed",
      noMatchingPlans: "No matching plans",
      noMatchingRuns: "No matching runs",
      needCreateChat: "Create a chat first.",
      needDescribeTask: "Describe the task in the chat first.",
      startRunFailedNoId: "Failed to start run: missing run_id",
      planGenerated: "Plan created",
      planGeneratedNoId: "Plan created.",
      planEmpty: "No plan text.",
      taskChainEmpty: "Task chain: (empty)",
      chatFailed: "Chat failed",
      planFailed: "Plan generation failed",
      loadRunFailed: "Failed to load run",
      loadPlanFailed: "Failed to load plan",
      planLocked: "Plan is executing or awaiting review; cannot create a new plan.",
      loadPatchsetFailed: "Failed to load patchset",
      loadFailureDetailFailed: "Failed to load failure details",
      applyFailed: "Apply failed",
      deleteFailed: "Delete failed",
      cancelFailed: "Cancel failed",
      retryFailed: "Retry failed",
      reworkFailed: "Rework failed",
      discardFailed: "Discard failed",
      openFileFailed: "Failed to open file",
      confirmDeleteRun: "Delete this run? Related artifacts will also be removed.",
      confirmDeletePlan: "Delete this plan? Related runs and artifacts will also be removed.",
      confirmCancelRun: "Cancel the current run?",
      confirmDeleteChat: "Delete this chat?",
      confirmApproveProfile: "Approve this profile?",
      confirmRejectProfile: "Reject this profile?",
      runCompletedApplyHint: "Run completed. Review and apply changes if needed.",
      taskChainLoading: "Loading task chain...",
      taskChainEmptyData: "No task chain data.",
      reviewLoading: "Loading patchset...",
      eventStreamReconnecting: "Reconnecting...",
      eventStreamWaiting: "Waiting for events...",
      eventStreamDisconnected: "Event stream disconnected.",
      awaitingReviewReady: "Awaiting review (patchset ready)",
      runFailed: "Run failed",
      runCanceled: "Canceled",
      runDiscarded: "Discarded",
      runCompleted: "Completed",
      codexTimeout: "Codex timeout",
      codexFailed: "Codex failed",
      codexStart: "Codex generating",
      codexDone: "Codex responded",
      subagentStart: "Sub-agent running",
      subagentDone: "Verifier running",
      verificationDone: "Verification completed",
      stageReady: "Stage workspace ready",
      runInit: "Run initialized",
      patchsetReady: "Patchset ready",
      awaitingReview: "Awaiting review",
      applyStart: "Applying changes",
      applyDone: "Changes applied",
      discardDone: "Changes discarded",
      runDone: "Run completed",
      stepRound: "Step round",
      stepRoundRunning: "Step round in progress",
      running: "Running",
      reworkFeedbackPlaceholder: "Optional: rework feedback",
      reworkNeedStep: "Step ID is required before rework.",
      reworkPrepared: "Rework prepared for {stepId}. Submit in the rework panel.",
      finalPlanPrompt: "Confirm the final plan (editable):",
      taskInputPlaceholder: "Describe the task you want to run",
      chatLoading: "Chatting",
      planLoading: "Codex is generating a plan...",
      sendLoading: "Sending...",
      queueEmpty: "No queued items.",
      noVerificationFailures: "No verification failures.",
      noProfile: "No profile data.",
      policyNotice: "File access and command permissions keep the assistant's actions safe.",
      checksGuide: "Add validations before execution to keep things secure.",
      rulesGuide: "Capture team experience as rules to guide AI behavior.",
      packageIntro: "Open the language or experience pack views, validate JSON formats, and inspect Markdown previews.",
      noBuiltinPacks: "No builtin packs",
      noUserPacks: "No user packs",
      noLearnedPack: "No learned pack",
      workspaceIdNotFound: "Workspace ID not found",
      packFormatInvalid: "Pack format invalid",
      packParseFailed: "Failed to parse pack file",
      noLessons: "No lessons available",
      noCommandPatterns: "No command patterns",
      noErrorSignatures: "No error signatures",
      noFixHints: "No fix hints",
      noChecks: "No checks",
      noRules: "No rules",
      noImportedPacks: "No imported packs"
    },
    labels: {
      workspacePath: "Workspace path",
      searchPlans: "Search plans",
      searchRuns: "Search runs",
      updated: "Updated",
      tasks: "Tasks",
      status: "Status",
      run: "Run",
      plan: "Plan",
      workspace: "Workspace",
      workspacePathDescription: "Current project workspace path",
      workspacePlaceholder: "Enter workspace path",
      browse: "Browse",
      policy: "Policy",
      policyConfig: "Policy settings",
      policyConfigDescription: "Manage AI assistant policies, checks, and rules",
      extraChecks: "Checks",
      checksDescription: "Add validations that run before execution",
      rules: "Rules",
      rulesDescription: "Define team conventions and behavior guidance",
      checksPanelMeta: "List active checks to guard preconditions.",
      addCheck: "Add check",
      checksFormMeta: "Describe validation logic via JSON; press Enter to add.",
      checkJsonPlaceholder: "Describe the check using JSON",
      scopeOptional: "Scope (optional)",
      rulesPanelMeta: "Document shared team behavior guidance.",
      addRule: "Add rule",
      rulesFormMeta: "Describe rules, optionally including categories or scope.",
      ruleContent: "Rule content",
      categoryOptional: "Category (optional)",
      runId: "Run ID",
      planId: "Plan ID",
      inputTask: "Input task",
      currentStage: "Current stage",
      task: "Task",
      taskChain: "Task chain",
      taskChainProgress: "Task chain progress",
      taskId: "ID",
      dependencies: "Dependencies",
      capabilities: "Capabilities",
      stream: "Stream",
      queueActions: "Queue actions",
      queueStatusGlobal: "Queue status (global)",
      chatTitle: "Chat title",
      finalPlan: "Final plan",
      listView: "List",
      graphView: "Graph",
      profileSubtitle: "Manage policies, checks, and rules for the AI assistant",
      policySafe: "Safe",
      policyGuarded: "Guarded",
      policyFull: "Full",
      tasksDone: "Done",
      tasksDoing: "In progress",
      tasksFailed: "Failed",
      fileAccessPolicy: "File access",
      fileAccessPolicyDescription: "Control which files and directories the assistant can touch",
      hardPolicyAllowWrite: "Allowed write paths",
      allowWriteHelp: "List folders or files the assistant may modify",
      allowWritePlaceholder: "Add allowed write path",
      hardPolicyDenyWrite: "Denied write paths",
      denyWriteHelp: "Protect sensitive directories from modification",
      denyWritePlaceholder: "Add denied write path",
      commandPolicy: "Command permissions",
      commandPolicyDescription: "Limit commands or tools the assistant can execute",
      hardPolicyAllowedCommands: "Allowed commands",
      allowedCommandsHelp: "Enter command or tool names allowed to run",
      allowedCommandsPlaceholder: "Add more commands...",
      executionPolicy: "Execution parameters",
      executionPolicyDescription: "Configure command timeout and concurrency limits",
      hardPolicyCommandTimeout: "Command timeout",
      commandTimeoutHelp: "Commands running longer than this are terminated",
      secondsUnit: "seconds",
      hardPolicyMaxConcurrency: "Concurrency limit",
      maxConcurrencyHelp: "Maximum commands running at the same time",
      hardPolicyReasons: "Rejection reasons",
      packageSubtitle: "Manage language & experience pack imports/exports",
      packageIntroTitle: "Package center",
      languagePack: "Language pack",
      experiencePack: "Experience pack",
      active: "Active",
      builtin: "Built-in",
      user: "User",
      learned: "Learned",
      importPack: "Import pack",
      selectedFile: "Selected file",
      dragPackHere: "Drag a pack file here",
      dropFileHint: "JSON format required",
      stats: "Stats",
      lessons: "Lessons",
      importedPacks: "Imported packs",
      exportMemory: "Export memory",
      exportName: "Export name",
      description: "Description",
      info: "Info",
      name: "Name",
      version: "Version",
      source: "Source",
      author: "Author",
      tags: "Tags",
      applicability: "Applicability",
      projectTypes: "Project types",
      detectPatterns: "Detect patterns",
      commandPatterns: "Command patterns",
      errorSignatures: "Error signatures",
      fixHints: "Fix hints",
      enabled: "Enabled",
      yes: "Yes",
      no: "No",
      successRate: "Success rate",
      activeRuns: "Active runs",
      systemResources: "System resources",
      roleSystem: "System",
      roleUser: "User",
      roleAssistant: "Assistant",
      warning: "Warning",
      error: "Error",
      command: "Command",
      file: "File",
      expected: "Expected",
      actual: "Actual",
      hint: "Hint",
      tagInputHint: "Press Enter to add"
    },
    prompts: {
      systemLanguage: "Please respond in English.",
      finalPlanPrefix: "Final plan:"
    }
  }
};

export type TranslationKeys = typeof TRANSLATIONS["zh"];

export function getLabels(language: Language): TranslationKeys {
  return TRANSLATIONS[language];
}

export function getStoredLanguage(): Language {
  if (typeof window === "undefined") return "zh";
  const stored = localStorage.getItem(STORAGE_KEY);
  return stored === "en" || stored === "zh" ? stored : "zh";
}

export function setStoredLanguage(language: Language): void {
  if (typeof window === "undefined") return;
  localStorage.setItem(STORAGE_KEY, language);
  window.dispatchEvent(new CustomEvent<Language>(LANGUAGE_CHANGE_EVENT, { detail: language }));
}

export const LABELS = TRANSLATIONS.zh;
